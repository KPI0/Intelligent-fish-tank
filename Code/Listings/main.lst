C51 COMPILER V9.52.0.0   MAIN                                                              10/29/2022 15:57:36 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Keil_vn\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJE
                    -CT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "Delay.h"
   3          #include "LCD1602.h"
   4          #include "Timer0.h"
   5          #include "delaytime10us.h"
   6          #include "MotorRun.h"
   7          #include "OneWire.h"
   8          #include "DS18B20.h"
   9          #include <intrins.h>
  10          //HC-SR04超声波引脚
  11          sbit TRIG=P1^6;
  12          sbit ECHO=P1^7;
  13          //KEY、1KEY2按键引脚
  14          sbit KEY1=P3^1;
  15          sbit KEY2=P3^0;
  16          //LCD1602数据引脚
  17          sbit LCD_E=P2^7;
  18          sbit LCD_RW=P2^5;
  19          sbit LCD_RS=P2^6;
  20          //按键输出控制ULN2003引脚
  21          sbit RE1=P2^0;
  22          sbit RE2=P2^1;
  23          
  24          unsigned char code word3[]="0123456789";
  25          unsigned int Set=40;
  26          unsigned int Now;
  27          unsigned int count_T0=0,count_1ms,miao=0;
  28          unsigned int High_Time;
  29          unsigned char flag;
  30          
  31          /********函数总集*********/
  32          void KEY1_Scan();
  33          void KEY2_Scan();
  34          void lcd_write_com(unsigned char com);
  35          void lcd_write_data(unsigned char dat);
  36          void lcdInit();
  37          void display_LCD(unsigned char hang,unsigned char lie,unsigned dat);
  38          void Timer0_Init();
  39          void delayms(unsigned char t);
  40          void scan_key();
  41          unsigned int WAVE();
  42          void display_string();
  43          void Timer_delay(unsigned int BS);
  44          void jidianqiInit();
  45          float T;
  46          
  47          /************************主函数************************/
  48          void main()
  49          {
  50   1          unsigned char bai,shi,ge;
  51   1          jidianqiInit();
  52   1        
  53   1        lcdInit();
  54   1        display_string();
C51 COMPILER V9.52.0.0   MAIN                                                              10/29/2022 15:57:36 PAGE 2   

  55   1          
  56   1        LCD_Init();
  57   1        Timer0Init();
  58   1        
  59   1        DS18B20_ConvertT();   //上电先转换一次温度，防止第一次读数据错误
  60   1        Delay(100);     //等待转换完成
  61   1        LCD_Init();
  62   1        
  63   1        LCD_ShowString(1,1,"Temp:");
  64   1        LCD_ShowString(1,15,"C");
  65   1        LCD_ShowString(2,1,"High:");
  66   1        LCD_ShowString(2,15,"cm");
  67   1        while(1)
  68   1        {
  69   2          DS18B20_ConvertT(); //转换温度
  70   2          T=DS18B20_ReadT();  //读取温度
  71   2          if(T<0)       //如果温度小于0
  72   2          {
  73   3            LCD_ShowChar(1,7,'-');  //显示负号
  74   3            T=-T;     //将温度变为正数
  75   3          }
  76   2          else        //如果温度大于等于0
  77   2          {
  78   3            LCD_ShowChar(1,7,'+');  //显示正号
  79   3          }
  80   2          LCD_ShowNum(1,8,T,2);   //显示温度整数部分
  81   2          LCD_ShowChar(1,10,'.');   //显示小数点
  82   2          LCD_ShowNum(1,11,(unsigned long)(T*10000)%10000,3);//显示温度小数部分
  83   2          KEY1_Scan();
  84   2          KEY2_Scan();
  85   2          scan_key();
  86   2          
  87   2          High_Time=WAVE();//超声波
  88   2          
  89   2          Now=(int)(High_Time*0.0175);
  90   2        
  91   2          bai=Now/100%10;
  92   2          shi=Now/10%10;
  93   2          ge=Now%10;
  94   2          
  95   2          if(bai!=0)
  96   2          {
  97   3        
  98   3           delayms(1);
  99   3          }
 100   2          display_LCD(1,7,word3[shi]);
 101   2          delayms(1);
 102   2          display_LCD(1,8,word3[ge]);
 103   2          delayms(1);
 104   2          
 105   2        }
 106   1      }
 107          
 108          void Timer_delay(unsigned int BS)//T1延时±0.5ms
 109          {
 110   1        unsigned int k;
 111   1        for(k=0;k<BS;k++)
 112   1        {
 113   2          TH1=(65536-100)/256;
 114   2          TL1=(65536-100)%256;
 115   2          while(TF1==0);
 116   2          TF1=0;
C51 COMPILER V9.52.0.0   MAIN                                                              10/29/2022 15:57:36 PAGE 3   

 117   2        }
 118   1      }
 119          /*显示开始的字母*/
 120          void display_string()
 121          {
 122   1        unsigned m,n;
 123   1      }
*** WARNING C280 IN LINE 122 OF main.c: 'm': unreferenced local variable
*** WARNING C280 IN LINE 122 OF main.c: 'n': unreferenced local variable
 124          /*超声波计算时间*/
 125          unsigned int WAVE()
 126          {
 127   1          unsigned int result;
 128   1          unsigned char p;
 129   1          TRIG=0;
 130   1          _nop_();//1微秒
 131   1          TRIG=1;
 132   1          for(p=0;p<10;p++);//大于10us
 133   1      
 134   1          TRIG=0;
 135   1          while(ECHO==0);//等高电平来
 136   1          Timer0_Init();//开始计时记高电平时间即超声波发射--返回时间
 137   1          while(ECHO)
 138   1          {
 139   2             if((TH0>0x8c)|| (TH0==0x8c&&TL0>0xa0))break;
 140   2          }
 141   1          TR0=0;
 142   1          //18us=18000ms=4650H  ;100us--18ms有效   超过36ms无效 36ms=8cA0
 143   1           if((TH0<0x46)|| (TH0==0x46&&TL0<=0x50))
 144   1           {
 145   2             result=(TH0<<8)+TL0;
 146   2             return result;
 147   2           }
 148   1          else return 0;
 149   1      }
 150          
 151          /*LCD初始化*/
 152          void lcdInit()
 153          {
 154   1        lcd_write_com(0x38);//字符为5*7点阵
 155   1        lcd_write_com(0x0c);//显示开、光标关、闪烁关
 156   1        lcd_write_com(0x06);//写入数据后光标右移一位，显示屏不动
 157   1        lcd_write_com(0x01);//清屏
 158   1        lcd_write_com(0x80);//设置数据指针起点
 159   1      }
 160          
 161          /*LCD写命令*/
 162          void lcd_write_com(unsigned char com)
 163          {
 164   1        LCD_E=0;
 165   1        LCD_RS=0;//命令
 166   1        LCD_RW=0;//写入
 167   1        P0=com;
 168   1        delayms(1);
 169   1        LCD_E=1;//写入时序
 170   1        delayms(1);
 171   1        LCD_E=0;
 172   1      
 173   1      }
 174          
 175          /*LCD写数据*/
 176          void lcd_write_data(unsigned char dat)
C51 COMPILER V9.52.0.0   MAIN                                                              10/29/2022 15:57:36 PAGE 4   

 177          {
 178   1        LCD_E=0;
 179   1        LCD_RW=0;//写入
 180   1        LCD_RS=1;//数据
 181   1        P0=dat;
 182   1        delayms(1);
 183   1        LCD_E=1;
 184   1        delayms(1);
 185   1        LCD_E=0;
 186   1      }
 187          /*LCD显示*/
 188          void display_LCD(unsigned char hang,unsigned char lie,unsigned value) 
 189          {
 190   1        if(hang==0)
 191   1        {
 192   2          lcd_write_com(0x80+lie);
 193   2        }
 194   1        if(hang==1)
 195   1        {
 196   2          lcd_write_com(0xc0+lie);
 197   2        }
 198   1        lcd_write_data(value);
 199   1      }
 200          
 201          
 202          /*定时器初始化*///T1延时，T0中断
 203          void Timer0_Init()
 204          {
 205   1        //count_T0=0;
 206   1        //miao=0;
 207   1        TMOD=0x11;
 208   1        TH0=0;
 209   1        TL0=0;
 210   1        //ET0=1;
 211   1        TR0=1;TR1=1;
 212   1        //EA=1;
 213   1      }
 214          void Timer0() interrupt 1
 215          {
 216   1        TH0=0;
 217   1        TL0=0;
 218   1      
 219   1      }
 220          
 221          /*按键扫描*/
 222          void scan_key()
 223          {
 224   1        
 225   1        P1=0xf0;
 226   1        if(P1!=0xff)delayms(10);
 227   1      
 228   1      }
 229          
 230          void delayms(unsigned char t)
 231          {
 232   1        unsigned i,j;
 233   1        for(i=0;i<t;i++)
 234   1           for(j=0;j<120;j++);
 235   1      }
 236          
 237          /***********继电器初始化******************/
 238          /**
C51 COMPILER V9.52.0.0   MAIN                                                              10/29/2022 15:57:36 PAGE 5   

 239            * @brief  加水和抽水的初始化
 240            * @param  无
 241            * @retval 无
 242            */
 243          void jidianqiInit ()
 244          {
 245   1        
 246   1          RE1=0;
 247   1          RE2=0;
 248   1      }
 249          
 250          /***********按键一控制换水***************/
 251          /**
 252            * @brief  按键一按下控制直流电机同时进行加水和抽水
 253            * @param  无
 254            * @retval 无
 255            */
 256          
 257          void KEY1_Scan()
 258          {
 259   1        if(KEY1 == 0)
 260   1        {
 261   2          Delay(200);
 262   2          while(KEY1 == 0);
 263   2          
 264   2            Delay(200);
 265   2            RE1=~RE1;
 266   2            RE2=~RE2; 
 267   2          
 268   2        }
 269   1      }
 270          void KEY2_Scan()
 271          {
 272   1        if(KEY2 == 0)
 273   1        {
 274   2          Delay10us();
*** WARNING C206 IN LINE 274 OF main.c: 'Delay10us': missing function-prototype
 275   2          if(KEY2 == 0)
 276   2          {
 277   3            Delay10us();
 278   3            MotorRun(4389/2,1,100);//nangle=4096为一圈； drct=0为逆时针转动，drct=1为顺时针转动；
             - speed转速75`400；
 279   3            MotorRun(4389/2,0,100);//nangle=4096为一圈； drct=0为逆时针转动，drct=1为顺时针转动；
             - speed转速75`400；
 280   3          }
 281   2        }
 282   1      }
 283          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    723    ----
   CONSTANT SIZE    =     28    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
